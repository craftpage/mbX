<script>
const connectButton = document.getElementById("connect");
const accelerationElement = document.getElementById("acceleration");

let ble = null;
let device = null;

connectButton.addEventListener("click", connect);

function connect() {
  if (ble === null) {
    ble = new BleManager();
  }

  ble.startScanning(onDeviceFound);
}

function onDeviceFound(device) {
  if (device.name.includes("micro:bit")) {
    ble.stopScanning();
    this.device = device;
    device.connect().then(connectDevice);
  }
}

function connectDevice() {
  device.discoverServices().then(services => {
    services.forEach(service => {
      if (service.uuid === "0000ffe0-0000-1000-8000-00805f9b34fb") {
        service.getCharacteristics().then(characteristics => {
          characteristics.forEach(characteristic => {
            if (characteristic.uuid === "0000ffe1-0000-1000-8000-00805f9b34fb") {
              characteristic.onCharacteristicChanged(onDataReceived);
              characteristic.startNotifications();
            }
          });
        });
      }
    });
  });
}

function onDataReceived(event) {
  const data = event.target.value;
  accelerationElement.textContent = data;
}
</script>



<body>
  <h1>micro:bit加速度データ</h1>
  <p id="acceleration">加速度データを表示します。</p>
  <button id="connect">接続</button>
</body>
